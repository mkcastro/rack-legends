#!/bin/sh

# Get the current branch name
current_branch=$(git symbolic-ref --short HEAD)

# Prevent direct pushes to main
if [ "$current_branch" = "main" ]; then
  echo "âŒ ERROR: Direct pushes to 'main' are not allowed!"
  echo ""
  echo "Please follow the PR workflow:"
  echo "  1. Create a feature branch from main:"
  echo "     git checkout main"
  echo "     git pull origin main"
  echo "     git checkout -b feature/your-feature-name"
  echo ""
  echo "  2. If you already have commits on main, cherry-pick them:"
  echo "     git log main --oneline -5  # Find your commit hashes"
  echo "     git cherry-pick <commit-hash>"
  echo ""
  echo "  3. Push your feature branch and create a PR:"
  echo "     git push -u origin feature/your-feature-name"
  echo "     gh pr create --title \"feat: your feature\" --body \"...\""
  echo ""
  exit 1
fi

echo "ğŸ§ª Running tests before push..."

# Run unit tests
echo "ğŸ“ Running unit tests..."
pnpm exec vitest run --passWithNoTests || exit 1

# E2E tests disabled from pre-push for faster iteration
# Run manually with: pnpm test:e2e

echo "âœ… All tests passed! Proceeding with push."
